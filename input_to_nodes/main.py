
#!/usr/bin/env python3
"""
Transcribe an English video with Whisper and extract start + end images
for each spoken segment. All outputs are saved into `output/`.

Outputs:
  output/
    ├── transcript.txt
    ├── transcript.json
    ├── frames_manifest.json
    └── frames/
         ├── frame_<start>s_start.jpg
         └── frame_<end>s_end.jpg
"""

import subprocess
import pathlib
import os
import json
import cv2


def run_whisper(video_path: pathlib.Path, output_dir: pathlib.Path, model="small"):
    """Run Whisper CLI to generate transcript and JSON output."""
{"text": " So if I'm looking to make the golf swing as simple as possible, let's look at two areas of the golf swing that we can really try and make flow and move with ease, the body and the arms. Let's let the rest just go with the flow with what else is going. So in terms of the body, as long as we stand reasonably good, so standing in an athletic position, I always talk about it like, you know, if you're a football player and goalkeeper, you know, being in an athletic ready to move position, obviously making sure you're bending from the hips. From that kind of decent posture, if we in the back swing try and feel that we're going to get our heart to the sky and make it go behind the golf ball. So it's like I'm passing something to a guy over here. And in the same time, I'm then trying to feel I'm going to get my heart to the sky. If the heart's to the sky, that's going to give me a sense of just extending and rotating behind the golf ball. Pretty simple. So the back swing move is really going to be our heart to the sky and the arms to go to the side. If we try and feel like the arms go in or the arms go long or up, we tend to get the arms in a bit of a funky position. So the arms to the side, like we're passing someone with the heart to the sky. That then will transport the arms up to a position that's kind of over our shoulder and we can bounce the club to make sure we're hitting the right kind of point in our shoulder to give us the correct arc in our golf swing. So heart to the sky, arms to the side. Now in the false row, we're also looking for heart to the sky, arms to the side. And obviously as the arms then decelerate, they can then end up closer to our head and a bit more relaxed in their finish position, kind of finishing with style. So very simply, we're looking for heart to the sky, heart to the sky, arms to the side, arms to the side. From a decent starting position without being too fussy over how good the starting position is. If we got fussy in the start position, it would allow the golf swing to free roll more correctly, more orthodox, but let's try and keep this real simple. In terms of the false row and even the backswing to a degree, if we stand here, put our arms to the side and this arm obviously is outstretched, again making ourselves as wide as we possibly can in this windmill position, the false row. In order to get my hand to meet the palm of that hand, I'm going to have to shift. So this exercise where we try and slap our hands in that windmill position, starts to create then some pressure shift and some rotation. So heart to the sky, slap hands, pretty damn simple. Back swing, slap hands, heart to the sky. If the foot needs to work a bit, let it work. The main thing we're trying to achieve here is a motion of flow, a motion with the body, rotating and shifting the pressure slightly and the arms going to the side to give us that low point control and to give us that width in the golf swing and again, that structure and the radius we want to get good contact each time. So once you've done a few little movements, slapping your hands there and you've got then the motion feeling when you hit golf balls, it's heart to the sky and a sideways movement as opposed to an upward movement. Let's hit a few shots. So, stand relatively good, heart to the sky, arms to the side. And a very simple, straight looking, Disney struck golf shot. And that's kind of, if we were teaching a beginner, these are the kind of concepts I'd want them to have. We want to create some width, we want to create some rotation and we want to create some extension in the body. And we've done that with those two simple thoughts of heart to the sky, arms to the side. Let's go ahead and hit a couple more, just doing exactly the same thing. Stand good, heart to the sky, arms to the side. So if ever you're trying to give someone some advice like a neighbor that's an on golfer, this is what I'd get you to tell them, but also for yourself to declutter your mind, to get rid of the technical jargon, the overthinking, the positions which you might not need. Let's just do this. And on the golf course, heart to the sky is a great way of thinking. So just heart to the sky. And you will play simple, great golf forever.", "segments": [{"id": 0, "seek": 0, "start": 0.0, "end": 2.64, "text": " So if I'm looking to make the golf swing as simple as possible,", "tokens": [50364, 407, 498, 286, 478, 1237, 281, 652, 264, 12880, 11173, 382, 2199, 382, 1944, 11, 50496], "temperature": 0.0, "avg_logprob": -0.15973082341645894, "compression_ratio": 1.8243243243243243, "no_speech_prob": 0.0007855378207750618}, {"id": 1, "seek": 0, "start": 2.64, "end": 4.5600000000000005, "text": " let's look at two areas of the golf swing", "tokens": [50496, 718, 311, 574, 412, 732, 3179, 295, 264, 12880, 11173, 50592], "temperature": 0.0, "avg_logprob": -0.15973082341645894, "compression_ratio": 1.8243243243243243, "no_speech_prob": 0.0007855378207750618}, {"id": 2, "seek": 0, "start": 4.5600000000000005, "end": 9.120000000000001, "text": " that we can really try and make flow and move with ease,", "tokens": [50592, 300, 321, 393, 534, 853, 293, 652, 3095, 293, 1286, 365, 12708, 11, 50820], "temperature": 0.0, "avg_logprob": -0.15973082341645894, "compression_ratio": 1.8243243243243243, "no_speech_prob": 0.0007855378207750618}, {"id": 3, "seek": 0, "start": 9.120000000000001, "end": 11.24, "text": " the body and the arms.", "tokens": [50820, 264, 1772, 293, 264, 5812, 13, 50926], "temperature": 0.0, "avg_logprob": -0.15973082341645894, "compression_ratio": 1.8243243243243243, "no_speech_prob": 0.0007855378207750618}, {"id": 4, "seek": 0, "start": 11.24, "end": 13.24, "text": " Let's let the rest just go with the flow", "tokens": [50926, 961, 311, 718, 264, 1472, 445, 352, 365, 264, 3095, 51026], "temperature": 0.0, "avg_logprob": -0.15973082341645894, "compression_ratio": 1.8243243243243243, "no_speech_prob": 0.0007855378207750618}, {"id": 5, "seek": 0, "start": 13.24, "end": 14.84, "text": " with what else is going.", "tokens": [51026, 365, 437, 1646, 307, 516, 13, 51106], "temperature": 0.0, "avg_logprob": -0.15973082341645894, "compression_ratio": 1.8243243243243243, "no_speech_prob": 0.0007855378207750618}, {"id": 6, "seek": 0, "start": 14.84, "end": 16.64, "text": " So in terms of the body,", "tokens": [51106, 407, 294, 2115, 295, 264, 1772, 11, 51196], "temperature": 0.0, "avg_logprob": -0.15973082341645894, "compression_ratio": 1.8243243243243243, "no_speech_prob": 0.0007855378207750618}, {"id": 7, "seek": 0, "start": 16.64, "end": 18.16, "text": " as long as we stand reasonably good,", "tokens": [51196, 382, 938, 382, 321, 1463, 23551, 665, 11, 51272], "temperature": 0.0, "avg_logprob": -0.15973082341645894, "compression_ratio": 1.8243243243243243, "no_speech_prob": 0.0007855378207750618}, {"id": 8, "seek": 0, "start": 18.16, "end": 19.84, "text": " so standing in an athletic position,", "tokens": [51272, 370, 4877, 294, 364, 22496, 2535, 11, 51356], "temperature": 0.0, "avg_logprob": -0.15973082341645894, "compression_ratio": 1.8243243243243243, "no_speech_prob": 0.0007855378207750618}, {"id": 9, "seek": 0, "start": 19.84, "end": 21.04, "text": " I always talk about it like, you know,", "tokens": [51356, 286, 1009, 751, 466, 309, 411, 11, 291, 458, 11, 51416], "temperature": 0.0, "avg_logprob": -0.15973082341645894, "compression_ratio": 1.8243243243243243, "no_speech_prob": 0.0007855378207750618}, {"id": 10, "seek": 0, "start": 21.04, "end": 22.64, "text": " if you're a football player and goalkeeper,", "tokens": [51416, 498, 291, 434, 257, 7346, 4256, 293, 3387, 23083, 11, 51496], "temperature": 0.0, "avg_logprob": -0.15973082341645894, "compression_ratio": 1.8243243243243243, "no_speech_prob": 0.0007855378207750618}, {"id": 11, "seek": 0, "start": 22.64, "end": 25.76, "text": " you know, being in an athletic ready to move position,", "tokens": [51496, 291, 458, 11, 885, 294, 364, 22496, 1919, 281, 1286, 2535, 11, 51652], "temperature": 0.0, "avg_logprob": -0.15973082341645894, "compression_ratio": 1.8243243243243243, "no_speech_prob": 0.0007855378207750618}, {"id": 12, "seek": 0, "start": 25.76, "end": 28.84, "text": " obviously making sure you're bending from the hips.", "tokens": [51652, 2745, 1455, 988, 291, 434, 22487, 490, 264, 15233, 13, 51806], "temperature": 0.0, "avg_logprob": -0.15973082341645894, "compression_ratio": 1.8243243243243243, "no_speech_prob": 0.0007855378207750618}, {"id": 13, "seek": 2884, "start": 28.84, "end": 31.96, "text": " From that kind of decent posture,", "tokens": [50364, 3358, 300, 733, 295, 8681, 18502, 11, 50520], "temperature": 0.0, "avg_logprob": -0.12632907028739335, "compression_ratio": 1.9437751004016064, "no_speech_prob": 0.00013545731781050563}, {"id": 14, "seek": 2884, "start": 31.96, "end": 33.88, "text": " if we in the back swing try and feel that we're going to get", "tokens": [50520, 498, 321, 294, 264, 646, 11173, 853, 293, 841, 300, 321, 434, 516, 281, 483, 50616], "temperature": 0.0, "avg_logprob": -0.12632907028739335, "compression_ratio": 1.9437751004016064, "no_speech_prob": 0.00013545731781050563}, {"id": 15, "seek": 2884, "start": 33.88, "end": 39.0, "text": " our heart to the sky and make it go behind the golf ball.", "tokens": [50616, 527, 1917, 281, 264, 5443, 293, 652, 309, 352, 2261, 264, 12880, 2594, 13, 50872], "temperature": 0.0, "avg_logprob": -0.12632907028739335, "compression_ratio": 1.9437751004016064, "no_speech_prob": 0.00013545731781050563}, {"id": 16, "seek": 2884, "start": 39.0, "end": 43.6, "text": " So it's like I'm passing something to a guy over here.", "tokens": [50872, 407, 309, 311, 411, 286, 478, 8437, 746, 281, 257, 2146, 670, 510, 13, 51102], "temperature": 0.0, "avg_logprob": -0.12632907028739335, "compression_ratio": 1.9437751004016064, "no_speech_prob": 0.00013545731781050563}, {"id": 17, "seek": 2884, "start": 43.6, "end": 44.519999999999996, "text": " And in the same time,", "tokens": [51102, 400, 294, 264, 912, 565, 11, 51148], "temperature": 0.0, "avg_logprob": -0.12632907028739335, "compression_ratio": 1.9437751004016064, "no_speech_prob": 0.00013545731781050563}, {"id": 18, "seek": 2884, "start": 44.519999999999996, "end": 46.64, "text": " I'm then trying to feel I'm going to get my heart to the sky.", "tokens": [51148, 286, 478, 550, 1382, 281, 841, 286, 478, 516, 281, 483, 452, 1917, 281, 264, 5443, 13, 51254], "temperature": 0.0, "avg_logprob": -0.12632907028739335, "compression_ratio": 1.9437751004016064, "no_speech_prob": 0.00013545731781050563}, {"id": 19, "seek": 2884, "start": 46.64, "end": 48.32, "text": " If the heart's to the sky,", "tokens": [51254, 759, 264, 1917, 311, 281, 264, 5443, 11, 51338], "temperature": 0.0, "avg_logprob": -0.12632907028739335, "compression_ratio": 1.9437751004016064, "no_speech_prob": 0.00013545731781050563}, {"id": 20, "seek": 2884, "start": 48.32, "end": 50.44, "text": " that's going to give me a sense of just extending", "tokens": [51338, 300, 311, 516, 281, 976, 385, 257, 2020, 295, 445, 24360, 51444], "temperature": 0.0, "avg_logprob": -0.12632907028739335, "compression_ratio": 1.9437751004016064, "no_speech_prob": 0.00013545731781050563}, {"id": 21, "seek": 2884, "start": 50.44, "end": 52.68, "text": " and rotating behind the golf ball.", "tokens": [51444, 293, 19627, 2261, 264, 12880, 2594, 13, 51556], "temperature": 0.0, "avg_logprob": -0.12632907028739335, "compression_ratio": 1.9437751004016064, "no_speech_prob": 0.00013545731781050563}, {"id": 22, "seek": 2884, "start": 53.56, "end": 54.760000000000005, "text": " Pretty simple.", "tokens": [51600, 10693, 2199, 13, 51660], "temperature": 0.0, "avg_logprob": -0.12632907028739335, "compression_ratio": 1.9437751004016064, "no_speech_prob": 0.00013545731781050563}, {"id": 23, "seek": 2884, "start": 54.760000000000005, "end": 58.8, "text": " So the back swing move is really going to be our heart to the sky", "tokens": [51660, 407, 264, 646, 11173, 1286, 307, 534, 516, 281, 312, 527, 1917, 281, 264, 5443, 51862], "temperature": 0.0, "avg_logprob": -0.12632907028739335, "compression_ratio": 1.9437751004016064, "no_speech_prob": 0.00013545731781050563}, {"id": 24, "seek": 5880, "start": 58.8, "end": 61.72, "text": " and the arms to go to the side.", "tokens": [50364, 293, 264, 5812, 281, 352, 281, 264, 1252, 13, 50510], "temperature": 0.0, "avg_logprob": -0.06980569434888435, "compression_ratio": 1.860655737704918, "no_speech_prob": 0.0001747002243064344}, {"id": 25, "seek": 5880, "start": 61.72, "end": 63.599999999999994, "text": " If we try and feel like the arms go in", "tokens": [50510, 759, 321, 853, 293, 841, 411, 264, 5812, 352, 294, 50604], "temperature": 0.0, "avg_logprob": -0.06980569434888435, "compression_ratio": 1.860655737704918, "no_speech_prob": 0.0001747002243064344}, {"id": 26, "seek": 5880, "start": 63.599999999999994, "end": 65.75999999999999, "text": " or the arms go long or up,", "tokens": [50604, 420, 264, 5812, 352, 938, 420, 493, 11, 50712], "temperature": 0.0, "avg_logprob": -0.06980569434888435, "compression_ratio": 1.860655737704918, "no_speech_prob": 0.0001747002243064344}, {"id": 27, "seek": 5880, "start": 65.75999999999999, "end": 68.39999999999999, "text": " we tend to get the arms in a bit of a funky position.", "tokens": [50712, 321, 3928, 281, 483, 264, 5812, 294, 257, 857, 295, 257, 33499, 2535, 13, 50844], "temperature": 0.0, "avg_logprob": -0.06980569434888435, "compression_ratio": 1.860655737704918, "no_speech_prob": 0.0001747002243064344}, {"id": 28, "seek": 5880, "start": 68.39999999999999, "end": 70.39999999999999, "text": " So the arms to the side,", "tokens": [50844, 407, 264, 5812, 281, 264, 1252, 11, 50944], "temperature": 0.0, "avg_logprob": -0.06980569434888435, "compression_ratio": 1.860655737704918, "no_speech_prob": 0.0001747002243064344}, {"id": 29, "seek": 5880, "start": 70.39999999999999, "end": 73.16, "text": " like we're passing someone with the heart to the sky.", "tokens": [50944, 411, 321, 434, 8437, 1580, 365, 264, 1917, 281, 264, 5443, 13, 51082], "temperature": 0.0, "avg_logprob": -0.06980569434888435, "compression_ratio": 1.860655737704918, "no_speech_prob": 0.0001747002243064344}, {"id": 30, "seek": 5880, "start": 73.16, "end": 75.44, "text": " That then will transport the arms up", "tokens": [51082, 663, 550, 486, 5495, 264, 5812, 493, 51196], "temperature": 0.0, "avg_logprob": -0.06980569434888435, "compression_ratio": 1.860655737704918, "no_speech_prob": 0.0001747002243064344}, {"id": 31, "seek": 5880, "start": 75.44, "end": 77.12, "text": " to a position that's kind of over our shoulder", "tokens": [51196, 281, 257, 2535, 300, 311, 733, 295, 670, 527, 7948, 51280], "temperature": 0.0, "avg_logprob": -0.06980569434888435, "compression_ratio": 1.860655737704918, "no_speech_prob": 0.0001747002243064344}, {"id": 32, "seek": 5880, "start": 77.12, "end": 78.56, "text": " and we can bounce the club", "tokens": [51280, 293, 321, 393, 15894, 264, 6482, 51352], "temperature": 0.0, "avg_logprob": -0.06980569434888435, "compression_ratio": 1.860655737704918, "no_speech_prob": 0.0001747002243064344}, {"id": 33, "seek": 5880, "start": 78.56, "end": 80.56, "text": " to make sure we're hitting the right kind of point", "tokens": [51352, 281, 652, 988, 321, 434, 8850, 264, 558, 733, 295, 935, 51452], "temperature": 0.0, "avg_logprob": -0.06980569434888435, "compression_ratio": 1.860655737704918, "no_speech_prob": 0.0001747002243064344}, {"id": 34, "seek": 5880, "start": 80.56, "end": 85.56, "text": " in our shoulder to give us the correct arc in our golf swing.", "tokens": [51452, 294, 527, 7948, 281, 976, 505, 264, 3006, 10346, 294, 527, 12880, 11173, 13, 51702], "temperature": 0.0, "avg_logprob": -0.06980569434888435, "compression_ratio": 1.860655737704918, "no_speech_prob": 0.0001747002243064344}, {"id": 35, "seek": 8556, "start": 85.56, "end": 89.16, "text": " So heart to the sky, arms to the side.", "tokens": [50364, 407, 1917, 281, 264, 5443, 11, 5812, 281, 264, 1252, 13, 50544], "temperature": 0.0, "avg_logprob": -0.13502575921230628, "compression_ratio": 2.0439024390243903, "no_speech_prob": 0.0003175129240844399}, {"id": 36, "seek": 8556, "start": 89.16, "end": 90.68, "text": " Now in the false row,", "tokens": [50544, 823, 294, 264, 7908, 5386, 11, 50620], "temperature": 0.0, "avg_logprob": -0.13502575921230628, "compression_ratio": 2.0439024390243903, "no_speech_prob": 0.0003175129240844399}, {"id": 37, "seek": 8556, "start": 90.68, "end": 95.28, "text": " we're also looking for heart to the sky, arms to the side.", "tokens": [50620, 321, 434, 611, 1237, 337, 1917, 281, 264, 5443, 11, 5812, 281, 264, 1252, 13, 50850], "temperature": 0.0, "avg_logprob": -0.13502575921230628, "compression_ratio": 2.0439024390243903, "no_speech_prob": 0.0003175129240844399}, {"id": 38, "seek": 8556, "start": 96.2, "end": 98.92, "text": " And obviously as the arms then decelerate,", "tokens": [50896, 400, 2745, 382, 264, 5812, 550, 979, 6185, 473, 11, 51032], "temperature": 0.0, "avg_logprob": -0.13502575921230628, "compression_ratio": 2.0439024390243903, "no_speech_prob": 0.0003175129240844399}, {"id": 39, "seek": 8556, "start": 98.92, "end": 101.0, "text": " they can then end up closer to our head", "tokens": [51032, 436, 393, 550, 917, 493, 4966, 281, 527, 1378, 51136], "temperature": 0.0, "avg_logprob": -0.13502575921230628, "compression_ratio": 2.0439024390243903, "no_speech_prob": 0.0003175129240844399}, {"id": 40, "seek": 8556, "start": 101.0, "end": 104.56, "text": " and a bit more relaxed in their finish position,", "tokens": [51136, 293, 257, 857, 544, 14628, 294, 641, 2413, 2535, 11, 51314], "temperature": 0.0, "avg_logprob": -0.13502575921230628, "compression_ratio": 2.0439024390243903, "no_speech_prob": 0.0003175129240844399}, {"id": 41, "seek": 8556, "start": 104.56, "end": 106.04, "text": " kind of finishing with style.", "tokens": [51314, 733, 295, 12693, 365, 3758, 13, 51388], "temperature": 0.0, "avg_logprob": -0.13502575921230628, "compression_ratio": 2.0439024390243903, "no_speech_prob": 0.0003175129240844399}, {"id": 42, "seek": 8556, "start": 107.0, "end": 109.32000000000001, "text": " So very simply, we're looking for heart to the sky,", "tokens": [51436, 407, 588, 2935, 11, 321, 434, 1237, 337, 1917, 281, 264, 5443, 11, 51552], "temperature": 0.0, "avg_logprob": -0.13502575921230628, "compression_ratio": 2.0439024390243903, "no_speech_prob": 0.0003175129240844399}, {"id": 43, "seek": 8556, "start": 109.32000000000001, "end": 112.92, "text": " heart to the sky, arms to the side, arms to the side.", "tokens": [51552, 1917, 281, 264, 5443, 11, 5812, 281, 264, 1252, 11, 5812, 281, 264, 1252, 13, 51732], "temperature": 0.0, "avg_logprob": -0.13502575921230628, "compression_ratio": 2.0439024390243903, "no_speech_prob": 0.0003175129240844399}, {"id": 44, "seek": 8556, "start": 112.92, "end": 114.48, "text": " From a decent starting position", "tokens": [51732, 3358, 257, 8681, 2891, 2535, 51810], "temperature": 0.0, "avg_logprob": -0.13502575921230628, "compression_ratio": 2.0439024390243903, "no_speech_prob": 0.0003175129240844399}, {"id": 45, "seek": 11448, "start": 114.48, "end": 118.16000000000001, "text": " without being too fussy over how good the starting position is.", "tokens": [50364, 1553, 885, 886, 283, 26394, 670, 577, 665, 264, 2891, 2535, 307, 13, 50548], "temperature": 0.0, "avg_logprob": -0.1498196208393657, "compression_ratio": 1.7859649122807018, "no_speech_prob": 0.00016940635396167636}, {"id": 46, "seek": 11448, "start": 119.32000000000001, "end": 120.64, "text": " If we got fussy in the start position,", "tokens": [50606, 759, 321, 658, 283, 26394, 294, 264, 722, 2535, 11, 50672], "temperature": 0.0, "avg_logprob": -0.1498196208393657, "compression_ratio": 1.7859649122807018, "no_speech_prob": 0.00016940635396167636}, {"id": 47, "seek": 11448, "start": 120.64, "end": 122.32000000000001, "text": " it would allow the golf swing to free roll", "tokens": [50672, 309, 576, 2089, 264, 12880, 11173, 281, 1737, 3373, 50756], "temperature": 0.0, "avg_logprob": -0.1498196208393657, "compression_ratio": 1.7859649122807018, "no_speech_prob": 0.00016940635396167636}, {"id": 48, "seek": 11448, "start": 122.32000000000001, "end": 124.28, "text": " more correctly, more orthodox,", "tokens": [50756, 544, 8944, 11, 544, 19052, 22189, 11, 50854], "temperature": 0.0, "avg_logprob": -0.1498196208393657, "compression_ratio": 1.7859649122807018, "no_speech_prob": 0.00016940635396167636}, {"id": 49, "seek": 11448, "start": 124.28, "end": 126.84, "text": " but let's try and keep this real simple.", "tokens": [50854, 457, 718, 311, 853, 293, 1066, 341, 957, 2199, 13, 50982], "temperature": 0.0, "avg_logprob": -0.1498196208393657, "compression_ratio": 1.7859649122807018, "no_speech_prob": 0.00016940635396167636}, {"id": 50, "seek": 11448, "start": 126.84, "end": 128.04, "text": " In terms of the false row", "tokens": [50982, 682, 2115, 295, 264, 7908, 5386, 51042], "temperature": 0.0, "avg_logprob": -0.1498196208393657, "compression_ratio": 1.7859649122807018, "no_speech_prob": 0.00016940635396167636}, {"id": 51, "seek": 11448, "start": 129.32, "end": 130.72, "text": " and even the backswing to a degree,", "tokens": [51106, 293, 754, 264, 19513, 7904, 281, 257, 4314, 11, 51176], "temperature": 0.0, "avg_logprob": -0.1498196208393657, "compression_ratio": 1.7859649122807018, "no_speech_prob": 0.00016940635396167636}, {"id": 52, "seek": 11448, "start": 130.72, "end": 133.72, "text": " if we stand here, put our arms to the side", "tokens": [51176, 498, 321, 1463, 510, 11, 829, 527, 5812, 281, 264, 1252, 51326], "temperature": 0.0, "avg_logprob": -0.1498196208393657, "compression_ratio": 1.7859649122807018, "no_speech_prob": 0.00016940635396167636}, {"id": 53, "seek": 11448, "start": 133.72, "end": 135.68, "text": " and this arm obviously is outstretched,", "tokens": [51326, 293, 341, 3726, 2745, 307, 484, 372, 45928, 11, 51424], "temperature": 0.0, "avg_logprob": -0.1498196208393657, "compression_ratio": 1.7859649122807018, "no_speech_prob": 0.00016940635396167636}, {"id": 54, "seek": 11448, "start": 135.68, "end": 137.56, "text": " again making ourselves as wide as we possibly can", "tokens": [51424, 797, 1455, 4175, 382, 4874, 382, 321, 6264, 393, 51518], "temperature": 0.0, "avg_logprob": -0.1498196208393657, "compression_ratio": 1.7859649122807018, "no_speech_prob": 0.00016940635396167636}, {"id": 55, "seek": 11448, "start": 137.56, "end": 139.32, "text": " in this windmill position, the false row.", "tokens": [51518, 294, 341, 2468, 18841, 2535, 11, 264, 7908, 5386, 13, 51606], "temperature": 0.0, "avg_logprob": -0.1498196208393657, "compression_ratio": 1.7859649122807018, "no_speech_prob": 0.00016940635396167636}, {"id": 56, "seek": 11448, "start": 139.32, "end": 143.48000000000002, "text": " In order to get my hand to meet the palm of that hand,", "tokens": [51606, 682, 1668, 281, 483, 452, 1011, 281, 1677, 264, 17018, 295, 300, 1011, 11, 51814], "temperature": 0.0, "avg_logprob": -0.1498196208393657, "compression_ratio": 1.7859649122807018, "no_speech_prob": 0.00016940635396167636}, {"id": 57, "seek": 14348, "start": 143.48, "end": 145.35999999999999, "text": " I'm going to have to shift.", "tokens": [50364, 286, 478, 516, 281, 362, 281, 5513, 13, 50458], "temperature": 0.0, "avg_logprob": -0.11673554959504501, "compression_ratio": 1.6837606837606838, "no_speech_prob": 0.00023515187785960734}, {"id": 58, "seek": 14348, "start": 145.35999999999999, "end": 148.28, "text": " So this exercise where we try and slap our hands", "tokens": [50458, 407, 341, 5380, 689, 321, 853, 293, 21075, 527, 2377, 50604], "temperature": 0.0, "avg_logprob": -0.11673554959504501, "compression_ratio": 1.6837606837606838, "no_speech_prob": 0.00023515187785960734}, {"id": 59, "seek": 14348, "start": 148.28, "end": 149.95999999999998, "text": " in that windmill position,", "tokens": [50604, 294, 300, 2468, 18841, 2535, 11, 50688], "temperature": 0.0, "avg_logprob": -0.11673554959504501, "compression_ratio": 1.6837606837606838, "no_speech_prob": 0.00023515187785960734}, {"id": 60, "seek": 14348, "start": 149.95999999999998, "end": 151.56, "text": " starts to create then some pressure shift", "tokens": [50688, 3719, 281, 1884, 550, 512, 3321, 5513, 50768], "temperature": 0.0, "avg_logprob": -0.11673554959504501, "compression_ratio": 1.6837606837606838, "no_speech_prob": 0.00023515187785960734}, {"id": 61, "seek": 14348, "start": 151.56, "end": 153.12, "text": " and some rotation.", "tokens": [50768, 293, 512, 12447, 13, 50846], "temperature": 0.0, "avg_logprob": -0.11673554959504501, "compression_ratio": 1.6837606837606838, "no_speech_prob": 0.00023515187785960734}, {"id": 62, "seek": 14348, "start": 153.12, "end": 158.12, "text": " So heart to the sky, slap hands, pretty damn simple.", "tokens": [50846, 407, 1917, 281, 264, 5443, 11, 21075, 2377, 11, 1238, 8151, 2199, 13, 51096], "temperature": 0.0, "avg_logprob": -0.11673554959504501, "compression_ratio": 1.6837606837606838, "no_speech_prob": 0.00023515187785960734}, {"id": 63, "seek": 14348, "start": 159.23999999999998, "end": 163.72, "text": " Back swing, slap hands, heart to the sky.", "tokens": [51152, 5833, 11173, 11, 21075, 2377, 11, 1917, 281, 264, 5443, 13, 51376], "temperature": 0.0, "avg_logprob": -0.11673554959504501, "compression_ratio": 1.6837606837606838, "no_speech_prob": 0.00023515187785960734}, {"id": 64, "seek": 14348, "start": 164.79999999999998, "end": 167.48, "text": " If the foot needs to work a bit, let it work.", "tokens": [51430, 759, 264, 2671, 2203, 281, 589, 257, 857, 11, 718, 309, 589, 13, 51564], "temperature": 0.0, "avg_logprob": -0.11673554959504501, "compression_ratio": 1.6837606837606838, "no_speech_prob": 0.00023515187785960734}, {"id": 65, "seek": 14348, "start": 167.48, "end": 168.95999999999998, "text": " The main thing we're trying to achieve here", "tokens": [51564, 440, 2135, 551, 321, 434, 1382, 281, 4584, 510, 51638], "temperature": 0.0, "avg_logprob": -0.11673554959504501, "compression_ratio": 1.6837606837606838, "no_speech_prob": 0.00023515187785960734}, {"id": 66, "seek": 14348, "start": 168.95999999999998, "end": 173.39999999999998, "text": " is a motion of flow, a motion with the body,", "tokens": [51638, 307, 257, 5394, 295, 3095, 11, 257, 5394, 365, 264, 1772, 11, 51860], "temperature": 0.0, "avg_logprob": -0.11673554959504501, "compression_ratio": 1.6837606837606838, "no_speech_prob": 0.00023515187785960734}, {"id": 67, "seek": 17340, "start": 173.4, "end": 176.12, "text": " rotating and shifting the pressure slightly", "tokens": [50364, 19627, 293, 17573, 264, 3321, 4748, 50500], "temperature": 0.0, "avg_logprob": -0.14622317420111763, "compression_ratio": 1.817829457364341, "no_speech_prob": 0.00028570127324201167}, {"id": 68, "seek": 17340, "start": 176.12, "end": 178.04, "text": " and the arms going to the side", "tokens": [50500, 293, 264, 5812, 516, 281, 264, 1252, 50596], "temperature": 0.0, "avg_logprob": -0.14622317420111763, "compression_ratio": 1.817829457364341, "no_speech_prob": 0.00028570127324201167}, {"id": 69, "seek": 17340, "start": 178.04, "end": 179.88, "text": " to give us that low point control", "tokens": [50596, 281, 976, 505, 300, 2295, 935, 1969, 50688], "temperature": 0.0, "avg_logprob": -0.14622317420111763, "compression_ratio": 1.817829457364341, "no_speech_prob": 0.00028570127324201167}, {"id": 70, "seek": 17340, "start": 179.88, "end": 182.12, "text": " and to give us that width in the golf swing", "tokens": [50688, 293, 281, 976, 505, 300, 11402, 294, 264, 12880, 11173, 50800], "temperature": 0.0, "avg_logprob": -0.14622317420111763, "compression_ratio": 1.817829457364341, "no_speech_prob": 0.00028570127324201167}, {"id": 71, "seek": 17340, "start": 182.12, "end": 185.0, "text": " and again, that structure and the radius we want", "tokens": [50800, 293, 797, 11, 300, 3877, 293, 264, 15845, 321, 528, 50944], "temperature": 0.0, "avg_logprob": -0.14622317420111763, "compression_ratio": 1.817829457364341, "no_speech_prob": 0.00028570127324201167}, {"id": 72, "seek": 17340, "start": 185.0, "end": 186.8, "text": " to get good contact each time.", "tokens": [50944, 281, 483, 665, 3385, 1184, 565, 13, 51034], "temperature": 0.0, "avg_logprob": -0.14622317420111763, "compression_ratio": 1.817829457364341, "no_speech_prob": 0.00028570127324201167}, {"id": 73, "seek": 17340, "start": 186.8, "end": 189.64000000000001, "text": " So once you've done a few little movements,", "tokens": [51034, 407, 1564, 291, 600, 1096, 257, 1326, 707, 9981, 11, 51176], "temperature": 0.0, "avg_logprob": -0.14622317420111763, "compression_ratio": 1.817829457364341, "no_speech_prob": 0.00028570127324201167}, {"id": 74, "seek": 17340, "start": 189.64000000000001, "end": 191.8, "text": " slapping your hands there", "tokens": [51176, 8039, 3759, 428, 2377, 456, 51284], "temperature": 0.0, "avg_logprob": -0.14622317420111763, "compression_ratio": 1.817829457364341, "no_speech_prob": 0.00028570127324201167}, {"id": 75, "seek": 17340, "start": 191.8, "end": 193.4, "text": " and you've got then the motion feeling", "tokens": [51284, 293, 291, 600, 658, 550, 264, 5394, 2633, 51364], "temperature": 0.0, "avg_logprob": -0.14622317420111763, "compression_ratio": 1.817829457364341, "no_speech_prob": 0.00028570127324201167}, {"id": 76, "seek": 17340, "start": 193.4, "end": 195.6, "text": " when you hit golf balls, it's heart to the sky", "tokens": [51364, 562, 291, 2045, 12880, 9803, 11, 309, 311, 1917, 281, 264, 5443, 51474], "temperature": 0.0, "avg_logprob": -0.14622317420111763, "compression_ratio": 1.817829457364341, "no_speech_prob": 0.00028570127324201167}, {"id": 77, "seek": 17340, "start": 195.6, "end": 198.88, "text": " and a sideways movement as opposed to an upward movement.", "tokens": [51474, 293, 257, 26092, 3963, 382, 8851, 281, 364, 23452, 3963, 13, 51638], "temperature": 0.0, "avg_logprob": -0.14622317420111763, "compression_ratio": 1.817829457364341, "no_speech_prob": 0.00028570127324201167}, {"id": 78, "seek": 17340, "start": 200.16, "end": 201.20000000000002, "text": " Let's hit a few shots.", "tokens": [51702, 961, 311, 2045, 257, 1326, 8305, 13, 51754], "temperature": 0.0, "avg_logprob": -0.14622317420111763, "compression_ratio": 1.817829457364341, "no_speech_prob": 0.00028570127324201167}, {"id": 79, "seek": 20120, "start": 202.2, "end": 206.56, "text": " So, stand relatively good,", "tokens": [50414, 407, 11, 1463, 7226, 665, 11, 50632], "temperature": 0.0, "avg_logprob": -0.20596290357185132, "compression_ratio": 1.6764705882352942, "no_speech_prob": 0.00015518364671152085}, {"id": 80, "seek": 20120, "start": 206.56, "end": 208.32, "text": " heart to the sky, arms to the side.", "tokens": [50632, 1917, 281, 264, 5443, 11, 5812, 281, 264, 1252, 13, 50720], "temperature": 0.0, "avg_logprob": -0.20596290357185132, "compression_ratio": 1.6764705882352942, "no_speech_prob": 0.00015518364671152085}, {"id": 81, "seek": 20120, "start": 213.51999999999998, "end": 216.95999999999998, "text": " And a very simple, straight looking,", "tokens": [50980, 400, 257, 588, 2199, 11, 2997, 1237, 11, 51152], "temperature": 0.0, "avg_logprob": -0.20596290357185132, "compression_ratio": 1.6764705882352942, "no_speech_prob": 0.00015518364671152085}, {"id": 82, "seek": 20120, "start": 216.95999999999998, "end": 218.6, "text": " Disney struck golf shot.", "tokens": [51152, 8653, 13159, 12880, 3347, 13, 51234], "temperature": 0.0, "avg_logprob": -0.20596290357185132, "compression_ratio": 1.6764705882352942, "no_speech_prob": 0.00015518364671152085}, {"id": 83, "seek": 20120, "start": 219.56, "end": 222.51999999999998, "text": " And that's kind of, if we were teaching a beginner,", "tokens": [51282, 400, 300, 311, 733, 295, 11, 498, 321, 645, 4571, 257, 22080, 11, 51430], "temperature": 0.0, "avg_logprob": -0.20596290357185132, "compression_ratio": 1.6764705882352942, "no_speech_prob": 0.00015518364671152085}, {"id": 84, "seek": 20120, "start": 222.51999999999998, "end": 224.95999999999998, "text": " these are the kind of concepts I'd want them to have.", "tokens": [51430, 613, 366, 264, 733, 295, 10392, 286, 1116, 528, 552, 281, 362, 13, 51552], "temperature": 0.0, "avg_logprob": -0.20596290357185132, "compression_ratio": 1.6764705882352942, "no_speech_prob": 0.00015518364671152085}, {"id": 85, "seek": 20120, "start": 224.95999999999998, "end": 226.16, "text": " We want to create some width,", "tokens": [51552, 492, 528, 281, 1884, 512, 11402, 11, 51612], "temperature": 0.0, "avg_logprob": -0.20596290357185132, "compression_ratio": 1.6764705882352942, "no_speech_prob": 0.00015518364671152085}, {"id": 86, "seek": 20120, "start": 226.16, "end": 227.32, "text": " we want to create some rotation", "tokens": [51612, 321, 528, 281, 1884, 512, 12447, 51670], "temperature": 0.0, "avg_logprob": -0.20596290357185132, "compression_ratio": 1.6764705882352942, "no_speech_prob": 0.00015518364671152085}, {"id": 87, "seek": 20120, "start": 227.32, "end": 230.07999999999998, "text": " and we want to create some extension in the body.", "tokens": [51670, 293, 321, 528, 281, 1884, 512, 10320, 294, 264, 1772, 13, 51808], "temperature": 0.0, "avg_logprob": -0.20596290357185132, "compression_ratio": 1.6764705882352942, "no_speech_prob": 0.00015518364671152085}, {"id": 88, "seek": 23008, "start": 230.16000000000003, "end": 232.64000000000001, "text": " And we've done that with those two simple thoughts", "tokens": [50368, 400, 321, 600, 1096, 300, 365, 729, 732, 2199, 4598, 50492], "temperature": 0.0, "avg_logprob": -0.11566534349995275, "compression_ratio": 1.6772908366533865, "no_speech_prob": 6.984500214457512e-05}, {"id": 89, "seek": 23008, "start": 232.64000000000001, "end": 236.08, "text": " of heart to the sky, arms to the side.", "tokens": [50492, 295, 1917, 281, 264, 5443, 11, 5812, 281, 264, 1252, 13, 50664], "temperature": 0.0, "avg_logprob": -0.11566534349995275, "compression_ratio": 1.6772908366533865, "no_speech_prob": 6.984500214457512e-05}, {"id": 90, "seek": 23008, "start": 236.08, "end": 237.20000000000002, "text": " Let's go ahead and hit a couple more,", "tokens": [50664, 961, 311, 352, 2286, 293, 2045, 257, 1916, 544, 11, 50720], "temperature": 0.0, "avg_logprob": -0.11566534349995275, "compression_ratio": 1.6772908366533865, "no_speech_prob": 6.984500214457512e-05}, {"id": 91, "seek": 23008, "start": 237.20000000000002, "end": 239.20000000000002, "text": " just doing exactly the same thing.", "tokens": [50720, 445, 884, 2293, 264, 912, 551, 13, 50820], "temperature": 0.0, "avg_logprob": -0.11566534349995275, "compression_ratio": 1.6772908366533865, "no_speech_prob": 6.984500214457512e-05}, {"id": 92, "seek": 23008, "start": 239.20000000000002, "end": 242.0, "text": " Stand good, heart to the sky, arms to the side.", "tokens": [50820, 9133, 665, 11, 1917, 281, 264, 5443, 11, 5812, 281, 264, 1252, 13, 50960], "temperature": 0.0, "avg_logprob": -0.11566534349995275, "compression_ratio": 1.6772908366533865, "no_speech_prob": 6.984500214457512e-05}, {"id": 93, "seek": 23008, "start": 247.64000000000001, "end": 249.60000000000002, "text": " So if ever you're trying to give someone some advice", "tokens": [51242, 407, 498, 1562, 291, 434, 1382, 281, 976, 1580, 512, 5192, 51340], "temperature": 0.0, "avg_logprob": -0.11566534349995275, "compression_ratio": 1.6772908366533865, "no_speech_prob": 6.984500214457512e-05}, {"id": 94, "seek": 23008, "start": 249.60000000000002, "end": 251.0, "text": " like a neighbor that's an on golfer,", "tokens": [51340, 411, 257, 5987, 300, 311, 364, 322, 9988, 612, 11, 51410], "temperature": 0.0, "avg_logprob": -0.11566534349995275, "compression_ratio": 1.6772908366533865, "no_speech_prob": 6.984500214457512e-05}, {"id": 95, "seek": 23008, "start": 251.0, "end": 253.04000000000002, "text": " this is what I'd get you to tell them,", "tokens": [51410, 341, 307, 437, 286, 1116, 483, 291, 281, 980, 552, 11, 51512], "temperature": 0.0, "avg_logprob": -0.11566534349995275, "compression_ratio": 1.6772908366533865, "no_speech_prob": 6.984500214457512e-05}, {"id": 96, "seek": 23008, "start": 253.04000000000002, "end": 255.56, "text": " but also for yourself to declutter your mind,", "tokens": [51512, 457, 611, 337, 1803, 281, 7488, 9947, 428, 1575, 11, 51638], "temperature": 0.0, "avg_logprob": -0.11566534349995275, "compression_ratio": 1.6772908366533865, "no_speech_prob": 6.984500214457512e-05}, {"id": 97, "seek": 23008, "start": 255.56, "end": 257.56, "text": " to get rid of the technical jargon,", "tokens": [51638, 281, 483, 3973, 295, 264, 6191, 15181, 10660, 11, 51738], "temperature": 0.0, "avg_logprob": -0.11566534349995275, "compression_ratio": 1.6772908366533865, "no_speech_prob": 6.984500214457512e-05}, {"id": 98, "seek": 25756, "start": 257.56, "end": 260.68, "text": " the overthinking, the positions which you might not need.", "tokens": [50364, 264, 30998, 12408, 11, 264, 8432, 597, 291, 1062, 406, 643, 13, 50520], "temperature": 0.0, "avg_logprob": -0.18152574392465445, "compression_ratio": 1.472972972972973, "no_speech_prob": 0.00046789285261183977}, {"id": 99, "seek": 25756, "start": 260.68, "end": 261.52, "text": " Let's just do this.", "tokens": [50520, 961, 311, 445, 360, 341, 13, 50562], "temperature": 0.0, "avg_logprob": -0.18152574392465445, "compression_ratio": 1.472972972972973, "no_speech_prob": 0.00046789285261183977}, {"id": 100, "seek": 25756, "start": 261.52, "end": 263.72, "text": " And on the golf course,", "tokens": [50562, 400, 322, 264, 12880, 1164, 11, 50672], "temperature": 0.0, "avg_logprob": -0.18152574392465445, "compression_ratio": 1.472972972972973, "no_speech_prob": 0.00046789285261183977}, {"id": 101, "seek": 25756, "start": 263.72, "end": 266.0, "text": " heart to the sky is a great way of thinking.", "tokens": [50672, 1917, 281, 264, 5443, 307, 257, 869, 636, 295, 1953, 13, 50786], "temperature": 0.0, "avg_logprob": -0.18152574392465445, "compression_ratio": 1.472972972972973, "no_speech_prob": 0.00046789285261183977}, {"id": 102, "seek": 25756, "start": 266.0, "end": 267.84, "text": " So just heart to the sky.", "tokens": [50786, 407, 445, 1917, 281, 264, 5443, 13, 50878], "temperature": 0.0, "avg_logprob": -0.18152574392465445, "compression_ratio": 1.472972972972973, "no_speech_prob": 0.00046789285261183977}, {"id": 103, "seek": 25756, "start": 271.56, "end": 276.16, "text": " And you will play simple, great golf forever.", "tokens": [51064, 400, 291, 486, 862, 2199, 11, 869, 12880, 5680, 13, 51294], "temperature": 0.0, "avg_logprob": -0.18152574392465445, "compression_ratio": 1.472972972972973, "no_speech_prob": 0.00046789285261183977}], "language": "English"}(input) lewibs@lewibs:~/github/LifeLogger/input_to_nodes/data/output$ 
    print("🚀 Starting Whisper transcription...")

    os.makedirs(output_dir, exist_ok=True)

    subprocess.run(
        [
            "whisper",
            str(video_path),
            "--model", model,
            "--language", "English",
            "--output_dir", str(output_dir),
            "--output_format", "all",  # Generate .txt + .json + captions
            "--verbose", "False"
        ],
        check=True
    )

    txt_path = output_dir / f"{video_path.stem}.txt"
    json_path = output_dir / f"{video_path.stem}.json"

    if not json_path.exists():
        raise FileNotFoundError(f"❌ JSON output not found: {json_path}")

    with open(json_path, "r", encoding="utf-8") as f:
        data = json.load(f)

    print(f"✅ Whisper complete: {len(data['segments'])} segments found.")
    return data, txt_path


def extract_frame(video_path, timestamp, output_dir, tag="mid"):
    """Extract one frame at the given timestamp (in seconds)."""
    os.makedirs(output_dir, exist_ok=True)
    cap = cv2.VideoCapture(str(video_path))
    fps = cap.get(cv2.CAP_PROP_FPS)
    total_frames = int(cap.get(cv2.CAP_PROP_FRAME_COUNT))
    duration = total_frames / fps if fps else 0

    if timestamp > duration or duration == 0:
        print(f"⚠️ Timestamp {timestamp:.2f}s beyond video length ({duration:.2f}s). Skipping.")
        cap.release()
        return None

    frame_index = int(timestamp * fps)
    cap.set(cv2.CAP_PROP_POS_FRAMES, frame_index)
    success, frame = cap.read()
    cap.release()

    if not success:
        print(f"⚠️ Failed to read frame at {timestamp:.2f}s")
        return None

    out_path = pathlib.Path(output_dir) / f"frame_{timestamp:.2f}s_{tag}.jpg"
    cv2.imwrite(str(out_path), frame)
    return str(out_path)


def transcribe_and_extract(video_file, model="small"):
    """Run Whisper, then extract start/end frames for each segment."""
    video = pathlib.Path(video_file).expanduser().resolve()
    if not video.exists():
        raise FileNotFoundError(f"Video file not found: {video}")

    # Make unified output directory
    output_root = video.parent / "output"
    os.makedirs(output_root, exist_ok=True)

    # 1️⃣ Run Whisper
    data, txt_path = run_whisper(video, output_root, model=model)

    # 2️⃣ Extract frames per segment (start + end)
    frames_dir = output_root / "frames"
    manifest = []
    print("🖼️ Extracting start and end frames for each segment...")

    for seg in data["segments"]:
        start = seg["start"]
        end = seg["end"]
        text = seg["text"].strip()

        # Extract start + end frames
        frame_start = extract_frame(video, start, frames_dir, tag="start")
        frame_end = extract_frame(video, end, frames_dir, tag="end")

        if frame_start or frame_end:
            manifest.append({
                "start": start,
                "end": end,
                "text": text,
                "frame_start": frame_start,
                "frame_end": frame_end
            })

    # 3️⃣ Save manifest JSON
    manifest_path = output_root / "frames_manifest.json"
    with open(manifest_path, "w", encoding="utf-8") as f:
        json.dump(manifest, f, indent=2)

    print(f"✅ Extracted {len(manifest)} segments → {manifest_path}")
    print(f"📄 Transcript saved → {txt_path}")

    return manifest, txt_path


if __name__ == "__main__":
    manifest, txt = transcribe_and_extract(
        "./data/YTDown.com_YouTube_The-Easiest-Way-To-Swing-the-Golf-Club-S_Media_umQbG2MTZfU_001_1080p.mp4",
        model="small"
    )

    print("\n--- Manifest Preview ---")
    for item in manifest[:3]:
        print(f"[{item['start']:.2f}–{item['end']:.2f}s]")
        print(f"🖼️ {item['frame_start']} → {item['frame_end']}")
        print(f"💬 {item['text']}\n")

